<Project Sdk="Microsoft.NET.Sdk">
    <PropertyGroup>
        <TargetFramework>net10.0</TargetFramework>
        <RootNamespace>ET</RootNamespace>
        <LangVersion>default</LangVersion>
        <AssemblyName>ET.Loader</AssemblyName>
        <Configurations>Debug;Release</Configurations>
        <Platforms>AnyCPU</Platforms>
    </PropertyGroup>
    <PropertyGroup>
        <AppendTargetFrameworkToOutputPath>false</AppendTargetFrameworkToOutputPath>
        <SatelliteResourceLanguages>en</SatelliteResourceLanguages>
    </PropertyGroup>
    <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|AnyCPU'">
        <DefineConstants>DOTNET</DefineConstants>
        <OutputPath>$(SolutionDir)Bin</OutputPath> 
        <AllowUnsafeBlocks>false</AllowUnsafeBlocks>
        <TreatWarningsAsErrors>true</TreatWarningsAsErrors>
        <Optimize>false</Optimize>
        <NoWarn>CA2022</NoWarn>
    </PropertyGroup>
    <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|AnyCPU'"> 
        <DefineConstants>DOTNET</DefineConstants>
        <OutputPath>$(SolutionDir)Bin</OutputPath>
        <AllowUnsafeBlocks>false</AllowUnsafeBlocks>
        <TreatWarningsAsErrors>true</TreatWarningsAsErrors>
        <Optimize>true</Optimize>
        <DebugType>full</DebugType>
        <DebugSymbols>true</DebugSymbols>
        <Deterministic>false</Deterministic>
    </PropertyGroup>

    <!-- 动态读取 MainPackage.txt 并生成 Compile 项 -->
    <Target Name="AddPackageCompileItems" BeforeTargets="BeforeBuild;BeforeResolveReferences;CoreCompile">
        <ReadLinesFromFile File="$(SolutionDir)MainPackage.txt">
            <Output TaskParameter="Lines" ItemName="PackageNames" />
        </ReadLinesFromFile>
        <ItemGroup>
            <PackageNames Remove="@(PackageNames)" Condition="'%(Identity)' == ''" />
        </ItemGroup>
        <!-- 生成通配符路径 -->
        <ItemGroup>
            <LoaderShareGlobs Include="@(PackageNames->'$(SolutionDir)Packages/%(Identity)/Scripts/Loader/Share/**/*.cs')" />
            <LoaderServerGlobs Include="@(PackageNames->'$(SolutionDir)Packages/%(Identity)/Scripts/Loader/Server/**/*.cs')" />
            <CodeModeLoaderGlobs Include="@(PackageNames->'$(SolutionDir)Packages/%(Identity)/CodeMode/Loader/Server/**/*.cs')" />
        </ItemGroup>
        <!-- 使用 CreateItem 展开通配符 -->
        <CreateItem Include="@(LoaderShareGlobs)">
            <Output TaskParameter="Include" ItemName="Compile" />
        </CreateItem>
        <CreateItem Include="@(LoaderServerGlobs)">
            <Output TaskParameter="Include" ItemName="Compile" />
        </CreateItem>
        <CreateItem Include="@(CodeModeLoaderGlobs)">
            <Output TaskParameter="Include" ItemName="Compile" />
        </CreateItem>
    </Target>
    
    <ItemGroup>
      <PackageReference Include="CommandLineParser" Version="2.9.1" />
    </ItemGroup>
    <ItemGroup>
      <None Update="NLog.config">
        <CopyToOutputDirectory>Always</CopyToOutputDirectory>
      </None>
      <None Include="..\CodeMode\Loader\Server\NLog.config">
        <Link>cn.etetet.loader\CodeMode\Loader\Server\NLog.config</Link>
      </None>
    </ItemGroup>
    <ItemGroup>
      <ProjectReference Include="..\..\cn.etetet.core\DotNet~\ET.Core.csproj" />
    </ItemGroup>
</Project>