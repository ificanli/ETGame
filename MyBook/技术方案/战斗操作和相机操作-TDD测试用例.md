# 战斗操作和相机操作 - TDD测试用例文档

## 文档信息

- **项目名称**: ET游戏战斗系统
- **文档版本**: v1.0
- **创建日期**: 2026-03-01
- **开发方法**: TDD (Test-Driven Development)
- **状态**: 待实施

---

## 1. TDD开发流程说明

### 1.1 TDD三步循环（Red-Green-Refactor）

```
┌─────────────────────────────────────────────────────────┐
│  1. Red（红灯）: 编写失败的测试                          │
│     - 先写测试用例，此时测试必然失败                      │
│     - 明确功能需求和预期行为                             │
└─────────────────────────────────────────────────────────┘
                        ↓
┌─────────────────────────────────────────────────────────┐
│  2. Green（绿灯）: 编写最小实现使测试通过                │
│     - 只写足够让测试通过的代码                           │
│     - 不考虑优化，先让功能跑起来                         │
└─────────────────────────────────────────────────────────┘
                        ↓
┌─────────────────────────────────────────────────────────┐
│  3. Refactor（重构）: 优化代码                           │
│     - 在测试保护下重构代码                               │
│     - 消除重复，提高可读性                               │
│     - 确保测试仍然通过                                   │
└─────────────────────────────────────────────────────────┘
                        ↓
                   回到步骤1
```

### 1.2 本项目TDD实施原则

1. **测试先行**: 每个功能必须先写测试，再写实现
2. **小步前进**: 每次只实现一个小功能，快速迭代
3. **持续集成**: 每次提交前确保所有测试通过
4. **测试覆盖**: 核心逻辑测试覆盖率要求 > 80%
5. **可读性**: 测试代码要清晰易懂，作为功能文档

---

## 2. 测试用例文档结构

本TDD测试用例文档分为以下部分：

### 2.1 文档列表

- **主文档（本文档）**: 总览和TDD流程说明
- **Part 1**: 移动系统测试用例
- **Part 2**: 战斗系统测试用例（阵营、目标选择、武器）
- **Part 3**: 行为树系统测试用例
- **Part 4**: 集成测试和性能测试用例

### 2.2 测试用例模板

每个测试用例包含以下内容：

```markdown
#### 测试用例 X.X: [测试名称]

**测试目的**: 描述测试要验证什么功能

**前置条件**:
- 条件1
- 条件2

**测试步骤**:
1. 步骤1
2. 步骤2
3. 步骤3

**预期结果**:
- 结果1
- 结果2

**测试代码**:
```csharp
[Test]
public void TestName()
{
    // Arrange
    // Act
    // Assert
}
```
```

---

## 3. 测试环境配置

### 3.1 测试框架

使用ET Framework内置的测试系统：

```csharp
// 测试基类
public abstract class ETTestBase
{
    protected Scene scene;

    [SetUp]
    public virtual void Setup()
    {
        // 初始化测试场景
        scene = TestHelper.CreateTestScene();
    }

    [TearDown]
    public virtual void TearDown()
    {
        // 清理测试场景
        scene?.Dispose();
    }
}
```

### 3.2 Mock工具

```csharp
// Mock TimeInfo
public class MockTimeInfo
{
    private long currentTime = 0;

    public long ServerNow() => currentTime;
    public void Advance(long ms) => currentTime += ms;
    public void Reset() => currentTime = 0;
}

// Mock配置表
public class MockConfigCategory<T> where T : class
{
    private Dictionary<int, T> configs = new Dictionary<int, T>();

    public void Add(int id, T config) => configs[id] = config;
    public T Get(int id) => configs.TryGetValue(id, out var config) ? config : null;
}
```

---

## 4. 测试用例统计

### 4.1 测试用例总览

| 模块 | 测试用例数 | 优先级 | 文档位置 |
|------|-----------|--------|---------|
| 移动系统 | 12 | P0 | Part 1 |
| 阵营系统 | 4 | P0 | Part 2 |
| 目标选择 | 6 | P0 | Part 2 |
| 武器系统 | 8 | P0 | Part 2 |
| 行为树系统 | 10 | P1 | Part 3 |
| 集成测试 | 6 | P1 | Part 4 |
| 性能测试 | 4 | P2 | Part 4 |
| **总计** | **50** | - | - |

### 4.2 优先级说明

- **P0**: 核心功能，必须在第一周完成
- **P1**: 重要功能，必须在第二周完成
- **P2**: 优化功能，第三周完成

---

## 5. TDD实施计划

### 5.1 第一周：移动和战斗基础（P0测试）

**Day 1-2: 移动系统**
- 编写移动系统测试用例（12个）
- 实现MoveComponent扩展
- 实现摇杆输入处理
- 实现客户端预测

**Day 3-4: 阵营和目标选择**
- 编写阵营系统测试用例（4个）
- 编写目标选择测试用例（6个）
- 实现CampComponent
- 实现TargetSelectorComponent

**Day 5: 武器系统基础**
- 编写武器系统测试用例（8个）
- 实现WeaponComponent
- 实现弹药管理

### 5.2 第二周：行为树和集成（P1测试）

**Day 1-2: 行为树系统**
- 编写BT测试用例（10个）
- 实现BTComponent
- 实现BT节点库
- 实现武器BT

**Day 3-4: 集成测试**
- 编写集成测试用例（6个）
- 测试移动+射击
- 测试多人战斗
- 修复集成问题

**Day 5: 网络测试**
- 测试网络延迟
- 测试断线重连
- 优化网络同步

### 5.3 第三周：优化和压力测试（P2测试）

**Day 1-2: 性能优化**
- 编写性能测试用例（4个）
- 优化BT执行频率
- 优化NavMesh查询
- 优化网络广播

**Day 3-4: 压力测试**
- 12人同屏测试
- 长时间运行测试
- 内存泄漏检测

**Day 5: 文档和交付**
- 完善测试报告
- 代码审查
- 准备演示

---

## 6. 测试报告模板

### 6.1 每日测试报告

```markdown
# 测试报告 - YYYY-MM-DD

## 测试执行情况
- 执行测试数: X
- 通过: X
- 失败: X
- 跳过: X

## 失败测试分析
1. 测试名称
   - 失败原因
   - 修复方案
   - 预计修复时间

## 代码覆盖率
- 总体覆盖率: X%
- 核心模块覆盖率: X%

## 遗留问题
- 问题1
- 问题2
```

---

## 7. 下一步行动

1. 阅读 Part 1: 移动系统测试用例
2. 按照TDD流程开始实施
3. 每日更新测试报告
4. 持续集成和代码审查

---

**文档版本**: v1.0
**创建日期**: 2026-03-01
**状态**: 待实施
