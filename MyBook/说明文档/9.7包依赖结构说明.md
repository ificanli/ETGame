# 包依赖结构说明

## 依赖规则

1. 包之间只能单向依赖，不能相互依赖
2. 通常只能高层包依赖低层包
3. 如果包的 `packagegit.json` 中设置了 `AllowSameLevelAccess: true`，则允许未依赖它的同层包访问
4. 依赖必须递归声明，修改依赖时要把依赖的依赖全部递归加上
5. 假如A包依赖了B包，B包永远不能访问A包

## 层级总览

```
第5层 (业务层)     ← 游戏主包和顶层业务模块
第4层 (服务层)     ← 跨模块服务：ActorLocation、AOI等
第3层 (功能层)     ← 具体功能模块：移动、数值、寻路等
第2层 (基础设施层) ← 基础系统：Unit、行为树、HTTP等
第1层 (核心层)     ← 框架核心和基础定义
第0层 (无依赖层)   ← 无ET包依赖的独立库
```

## 第0层 — 无依赖层

无任何 `cn.etetet.*` 依赖的独立库。

| 包名 | Id | 说明 |
|------|----|------|
| cn.etetet.sourcegenerator | 20 | 源码生成器 |
| cn.etetet.memorypack | 30 | 序列化库 |
| cn.etetet.excel | 13 | Excel配置 |
| cn.etetet.recast | 14 | 导航网格寻路 |
| cn.etetet.lsentity | 21 | 帧同步Entity |
| cn.etetet.truesync | 22 | 定点数数学库 |
| cn.etetet.mathematics | 24 | 数学库 |
| cn.etetet.hybridclr | 45 | 热更新 |
| cn.etetet.packagemanager | 1100 | 包管理器 |
| cn.etetet.yiui | 1002 | YIUI基础 |
| cn.etetet.yiuieffect | 1306 | YIUI特效 |

## 第1层 — 核心层

框架核心和基础协议定义。

| 包名 | Id | 直接依赖 | AllowSameLevelAccess |
|------|----|----------|---------------------|
| cn.etetet.core | 1 | sourcegenerator, memorypack | - |
| cn.etetet.proto | 12 | core | - |
| cn.etetet.db | 51 | core | - |
| cn.etetet.yooassets | 7 | core | - |
| cn.etetet.yiuiinvoke | 1204 | core | true |
| cn.etetet.yiuiloopscrollrectasync | 1201 | core | true |
| cn.etetet.yiuiyooassets | 1203 | core | true |
| cn.etetet.yiuigm | 1301 | core | true |
| cn.etetet.yiuitips | 1302 | core | true |
| cn.etetet.yiuireddot | 1304 | core | true |
| cn.etetet.aspire | 101 | core, startconfig | - |

## 第2层 — 基础设施层

基础业务系统，依赖核心层。

| 包名 | Id | 直接依赖 | AllowSameLevelAccess |
|------|----|----------|---------------------|
| cn.etetet.unit | 5 | core, excel, proto | - |
| cn.etetet.behaviortree | 44 | core, excel, proto | - |
| cn.etetet.http | 16 | core, excel, proto | - |
| cn.etetet.startconfig | 29 | core, excel, proto | - |
| cn.etetet.console | 18 | core, excel, proto, loader | - |
| cn.etetet.loader | 2 | core, yooassets | - |
| cn.etetet.yiuiframework | 1001 | core, yiuiinvoke | true |
| cn.etetet.yiui3ddisplay | 1303 | yiuiframework | true |
| cn.etetet.yiuiluban | 1204 | (无ET依赖) | true |
| cn.etetet.servicediscovery | 50 | core, proto | true |

## 第3层 — 功能层

具体功能模块，依赖基础设施层。

| 包名 | Id | 直接依赖 | AllowSameLevelAccess |
|------|----|----------|---------------------|
| cn.etetet.numeric | 23 | core, excel, proto, unit | - |
| cn.etetet.move | 4 | core, excel, proto, unit | - |
| cn.etetet.netinner | 28 | core, excel, proto, startconfig, sourcegenerator | - |
| cn.etetet.router | 15 | core, excel, proto, startconfig, http | - |
| cn.etetet.item | 46 | core, excel, proto, unit | true |
| cn.etetet.equipment | 47 | core, excel, proto, unit | true |

## 第4层 — 服务层

跨模块服务，依赖功能层。

| 包名 | Id | 直接依赖 | AllowSameLevelAccess |
|------|----|----------|---------------------|
| cn.etetet.actorlocation | 3 | core, excel, proto, netinner, startconfig | - |
| cn.etetet.aoi | 19 | core, excel, proto, unit, numeric | - |

## 第5层 — 业务层

游戏顶层业务模块，全部设置了 `AllowSameLevelAccess: true`。

| 包名 | Id | 直接依赖 | AllowSameLevelAccess |
|------|----|----------|---------------------|
| cn.etetet.statesync (WOW主包) | 100 | core, excel, proto, unit, behaviortree, http, startconfig, console, numeric, move, recast, netinner, router, actorlocation, aoi, yiuiframework, yooassets, yiuitips, yiuigm, loader, yiuiyooassets, yiuiluban, test, map, servicediscovery, yiuiloopscrollrectasync, login, btnode, quest, item, mapmanager, yiuireddot, spell, robot, sourcegenerator, yiuiinvoke | true |
| cn.etetet.spell | 37 | core, excel, proto, unit, behaviortree, http, startconfig, console, numeric, netinner, router, actorlocation, aoi, yooassets, yiuiframework | true |
| cn.etetet.btnode | 40 | (无) | true |
| cn.etetet.test | 36 | (无) | true |
| cn.etetet.robot | 35 | (无) | true |
| cn.etetet.login | 9 | (无) | true |
| cn.etetet.map | 39 | (无) | true |
| cn.etetet.quest | 38 | (无) | true |
| cn.etetet.achievement | 41 | (无) | true |
| cn.etetet.mapmanager | 43 | (无) | true |

## 特殊包 — LockStep（帧同步主包）

独立的帧同步游戏主包，依赖链较长。

| 包名 | Id | AllowSameLevelAccess |
|------|----|---------------------|
| cn.etetet.lockstep | 11 | - |

直接依赖：packagemanager, actorlocation, core, loader, router, console, http, truesync, lsentity, login, netinner, hybridclr, excel, proto, sourcegenerator, yooassets, memorypack, startconfig, yiuiframework, yiuitips, yiuigm, yiuiyooassets, yiuiluban, test, servicediscovery, yiuiloopscrollrectasync, yiuireddot

## 依赖关系图（简化）

```
第5层  statesync(WOW) ──→ spell ──→ [第4层+第3层+第2层]
       login, map, test, robot, btnode, quest, achievement, mapmanager
       (这些包packagegit.json中无显式依赖，通过AllowSameLevelAccess被同层访问)

第4层  actorlocation ──→ netinner ──→ startconfig ──→ [第1层]
       aoi ──→ numeric ──→ unit ──→ [第1层]

第3层  numeric, move ──→ unit
       netinner ──→ startconfig
       router ──→ startconfig, http
       item, equipment ──→ unit

第2层  unit, behaviortree, http, startconfig ──→ core, excel, proto
       console ──→ core, excel, proto, loader
       loader ──→ core, yooassets
       yiuiframework ──→ core, yiuiinvoke

第1层  core ──→ sourcegenerator, memorypack
       proto ──→ core
       yooassets, db ──→ core

第0层  sourcegenerator, memorypack, excel, recast, mathematics...（无依赖）
```

## 备注

- Id 重复问题：`cn.etetet.yiuiinvoke`(1204) 和 `cn.etetet.yiuiluban`(1204) 的 Id 相同，可能需要修正
- 第5层中部分包（login, map, test 等）的 `package.json` 中无显式 ET 依赖声明，但通过 `AllowSameLevelAccess` 机制被其他同层包访问
- `cn.etetet.statesync` 是状态同步主包，packagegit.json 中 Name 为 "WOW"
